
CREATE TABLE users (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, username TEXT NOT NULL UNIQUE, hash TEXT NOT NULL, role TEXT NOT NULL DEFAULT 'inspector', created_at DATETIME DEFAULT CURRENT_TIMESTAMP);

CREATE TABLE forms (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, name TEXT NOT NULL UNIQUE, description TEXT NOT NULL, created_by INTEGER NOT NULL, FOREIGN KEY (created_by) REFERENCES users(id) );

CREATE TABLE form_fields (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, form_id INTEGER NOT NULL, label TEXT NOT NULL, field_type TEXT NOT NULL,  options TEXT, required BOOLEAN NOT NULL DEFAULT 1, display_order INTEGER DEFAULT 0,  FOREIGN KEY (form_id) REFERENCES forms(id) );

CREATE TABLE inspection_fields (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, inspection_id INTEGER NOT NULL, field_id INTEGER NOT NULL, value TEXT, comment TEXT, FOREIGN KEY (inspection_id) REFERENCES inspections(id), FOREIGN KEY (field_id) REFERENCES form_fields(id), UNIQUE(inspection_id, field_id));

CREATE TABLE inspections (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, form_id INTEGER NOT NULL, inspector_id INTEGER NOT NULL, submitted_at DATETIME DEFAULT CURRENT_TIMESTAMP, location TEXT,  notes TEXT,  score REAL, FOREIGN KEY (form_id) REFERENCES forms(id), FOREIGN KEY (inspector_id) REFERENCES users(id));

CREATE TABLE inspection_images (id INTEGER PRIMARY KEY AUTOINCREMENT, inspection_id INTEGER NOT NULL, filename TEXT NOT NULL, uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (inspection_id) REFERENCES inspections(id));